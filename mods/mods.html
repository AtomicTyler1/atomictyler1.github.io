<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atomic's Modding Page</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon/favicon.ico">
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom right, #ffdde1, #ee9ca7);
            overflow: hidden;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .container {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            position: relative;
            z-index: 10;
            opacity: 1;
            transition: opacity 1s ease;
        }

        h1 {
            font-size: 32px;
            margin: 0;
            color: #333;
        }

        p {
            font-size: 18px;
            margin-top: 10px;
            color: #555;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        .button {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border: none;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background 0.3s;
            width: 100%;
        }

        .button img {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .button:hover {
            background: rgba(255, 255, 255, 0.7);
        }

        .dropdown {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .dropdown-content {
            display: flex;
            flex-direction: column;
            margin-top: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 3px;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-base-color: 0,0,0,0;
            max-height: 0;
            opacity: 0;
            transform: translateY(-10px);
            transition: max-height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            text-align: center;
        }

        .dropdown-content a {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 5px;
            padding: 10px;
            text-decoration: none;
            color: #333;
            margin: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }

        .dropdown-content a img {
            width: 20px;
            height: 20px;
        }

        .dropdown-content a:hover {
            background: rgba(255, 255, 255, 0.7);
        }

        .open {
            max-height: 300px;
            opacity: 1;
            transform: translateY(0);
        }

        .leaf {
            position: absolute;
            top: -50px;
            left: 0;
            width: 30px;
            height: auto;
            opacity: 0.8;
            animation: fall linear infinite;
        }

        @keyframes fadeOut {
            from {
                opacity: 0.8;
            }
            to {
                opacity: 0;
            }
        }

        .fade-out {
            animation: fadeOut 1s forwards;
        }

        @keyframes fall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .dropdown-content::-webkit-scrollbar {
            width: 3px;
            border-radius: 50%;
            }
            
            .dropdown-content::-webkit-scrollbar-thumb {
            background-color: white;
            outline: 2px solid white;
            border-radius: 2.5%;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Welcome to my mods!</h1>
        <p>Take a look around :3</p>

        <div id="stats">
            <p><strong>Total Thunderstore Downloads:</strong> <span id="downloads">Loading...</span></p>
            <p><strong>Total Thunderstore Ratings:</strong> <span id="ratings">Loading...</span></p>
            <p><strong>Last API Call:</strong> <span id="lastChecked">Loading...</span></p>
        </div>
        

        <div class="button-container">

            <div class="dropdown">
                <button class="button" onclick="toggleDropdown('lethalMods', this)">
                    <img src="/images/icons/arrow.png" alt="Arrow">
                    Lethal Company Mods
                </button>
                <div id="lethalMods" class="dropdown-content">
                    <a href="https://thunderstore.io/c/lethal-company/p/AtomicStudio/Atomics_Cosmetics/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo"> 
                        Atomic's Cosmetics
                    </a>
                    <a href="https://thunderstore.io/c/lethal-company/p/AtomicStudio/Better_Shotgun_Tooltip/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo"> 
                        Better Shotgun Tooltip
                    </a>
                    <a href="https://thunderstore.io/c/lethal-company/p/AtomicStudio/Moved_Magnet_Switch/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo"> 
                        Moved Magnet Switch
                    </a>
                    <a href="https://thunderstore.io/c/lethal-company/p/AtomicStudio/Colorable_CozyLights/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo"> 
                        Colorable Cozy Lights
                    </a>
                    <a href="https://thunderstore.io/c/lethal-company/p/AtomicStudio/Atomics_Suits/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo"> 
                        Atomic's Suits
                    </a>
                </div>
            </div>

            <div class="dropdown">
                <button class="button" onclick="toggleDropdown('cwMods', this)">
                    <img src="/images/icons/arrow.png" alt="Arrow">
                    Content Warning Mods
                </button>
                <div id="cwMods" class="dropdown-content">
                    <a href="https://thunderstore.io/c/content-warning/p/AtomicStudio/Breakable_Windows/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo">
                        Breakable Windows
                    </a>
                    <a href="https://thunderstore.io/c/content-warning/p/AtomicStudio/Charging_Divebell/">
                        <img src="/images/buttons/thunderstore-logo.png" alt="Thunderstore Logo">
                        Charging Divebell
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3383270520">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Breakable Windows
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3383837077">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Divebell Charging
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3400376437">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Free Hospital Bills
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3389296239">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        More Visor Colors
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3386777900">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Suit Colors
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3386220143">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Divebell Oxygen Refill
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3385250537">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Exit Confirmation
                    </a>
                    <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=3385201967">
                        <img src="/images/buttons/steam-logo.png" alt="Steam Logo"> 
                        Configurable Film (Infinite Included)
                    </a>
                </div>
            </div>

            <div class="dropdown">
                <button class="button" onclick="toggleDropdown('otherGames', this)">
                    <img src="/images/icons/arrow.png" alt="Arrow">
                    Other Games Mods
                </button>
                <div id="otherGames" class="dropdown-content">
                    <div class="dropdown">
                        <button class="button" onclick="toggleSubDropdown('slimeRancher', this)">
                            <img src="/images/icons/arrow.png" alt="Arrow">
                            Slime Rancher Mods
                        </button>
                        <div id="slimeRancher" class="dropdown-content">
                            <a href="https://www.nexusmods.com/slimerancher/mods/578">
                                <img src="/images/buttons/nexus-logo.png" alt="Nexus Logo"> 
                                Increased VacPack Size
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <a href="https://www.youtube.com/watch?v=uHgt8giw1LY" class="button">Don't like my mods?</a>
            <a href="#" class="button" onclick="goBack()">Want to go back?</a>

        </div>
    </div>

    <script>

        async function fetchData() {
            const cacheKey = "modStats";
            const cacheTimeKey = "modStatsTimestamp";
            const cacheDuration = 5 * 60 * 1000;
            const now = Date.now();

            const cachedData = localStorage.getItem(cacheKey);
            const cachedTime = localStorage.getItem(cacheTimeKey);

            if (cachedData && cachedTime && now - cachedTime < cacheDuration) {
                console.log("Using cached data");
                return JSON.parse(cachedData);
            }

            console.log("Fetching new data...");
            try {
                const response = await fetch("https://gist.githubusercontent.com/AtomicTyler1/913a40238b453d557cb1073fd4c05a83/raw");
                if (!response.ok) throw new Error("Failed to fetch data");

                const data = await response.json();

                localStorage.setItem(cacheKey, JSON.stringify(data));
                localStorage.setItem(cacheTimeKey, now.toString());

                return data;
            } catch (error) {
                console.error("Error fetching data:", error);
                return cachedData ? JSON.parse(cachedData) : null;
            }
        }

        function updateUI(data) {
            if (!data) {
                document.getElementById("downloads").textContent = "Error loading data";
                document.getElementById("ratings").textContent = "Error loading data";
                return;
            }

            const lastCheckedTimestamp = new Date(data.last_checked * 1000);
            const formattedDate = `${lastCheckedTimestamp.getDate().toString().padStart(2, '0')}/${
                (lastCheckedTimestamp.getMonth() + 1).toString().padStart(2, '0')}/${
                lastCheckedTimestamp.getFullYear()} ${lastCheckedTimestamp.getHours().toString().padStart(2, '0')}:${
                lastCheckedTimestamp.getMinutes().toString().padStart(2, '0')}:${lastCheckedTimestamp.getSeconds().toString().padStart(2, '0')}`;

            document.getElementById("downloads").textContent = data.total_downloads.toLocaleString();
            document.getElementById("ratings").textContent = data.total_ratings.toLocaleString();
            document.getElementById("lastChecked").textContent = formattedDate + " (GMT)";

            
        }

        fetchData().then(data => {
            updateUI(data);
        });


        setInterval(async () => {
            console.log("Checking for new data...");
            const data = await fetchData();
            updateUI(data);
        }, 5 * 60 * 1000);

        window.onload = () => {
            document.body.style.opacity = "1";
        };

        function toggleDropdown(id, button) {
            const lethalMods = document.getElementById('lethalMods');
            const cwMods = document.getElementById('cwMods');
            const otherGames = document.getElementById('otherGames');
            const slimeRancher = document.getElementById('slimeRancher');

            let target = document.getElementById(id);
            let arrow = button.querySelector("img");

            if (target.classList.contains('open')) {
                target.classList.remove('open');
                arrow.style.transform = "rotate(0deg)";
            } else {
                lethalMods.classList.remove('open');
                cwMods.classList.remove('open');
                otherGames.classList.remove('open');
                slimeRancher.classList.remove('open');

                let allArrows = document.querySelectorAll(".button img");
                allArrows.forEach(img => img.style.transform = "rotate(0deg)");

                target.classList.add('open');
                arrow.style.transform = "rotate(90deg)";
            }
        }

        function toggleSubDropdown(id, button) {
            const slimeRancher = document.getElementById('slimeRancher');
            let arrow = button.querySelector("img");

            if (slimeRancher.classList.contains('open')) {
                slimeRancher.classList.remove('open');
                arrow.style.transform = "rotate(0deg)";
            } else {
                slimeRancher.classList.add('open');
                arrow.style.transform = "rotate(90deg)";
            }
        }

        function createLeaf() {
            const leaf = document.createElement("img");
            leaf.src = "/images/icons/leaf.png";
            leaf.classList.add("leaf");

            leaf.style.left = Math.random() * window.innerWidth + "px";
            const duration = Math.random() * 5 + 3;
            leaf.style.animationDuration = duration + "s";

            document.body.appendChild(leaf);

            setTimeout(() => {
                leaf.classList.add("fade-out");

                setTimeout(() => {
                    leaf.remove();
                }, 1000);
            }, duration * 1000);
        }

        setInterval(createLeaf, 750);

        function goBack() {
            document.body.style.opacity = "0";
            document.querySelector(".container").style.opacity = "0";

            setTimeout(() => {
                window.location.href = "https://atomictyler1.github.io";
            }, 1000);
        }

    </script>
</body>
</html>
